# UI-001.3 Lock UI - Implementation Tasks

**Epic**: UI Lock Interface  
**Points**: 21  
**Timeline**: Week 3-4  
**Depends**: BE-001.3 (Nov 25)

---

## ðŸ“‹ Stories (6 total)

### STORY-1: Multi-Editor Warning âš¡ (3 pts)

**Sprint**: Week 3 | **Status**: Ready (no BE dependency)

**User Story**:  
As a user, when 2+ editors in resource, I want warning banner, so I know conflicts may happen.

**Tasks**:

- [ ] Warning banner HTML/CSS (1h)
- [ ] Update `updateActiveUsers()` logic (1h)
- [ ] Red badge styles for conflicting editors (30min)
- [ ] Test 2+ editors scenario (30min)

**DoD**: Warning shows when editors > 1

**Files**: `complete-reports-test.html`, `embedded-reports-view.html`

---

### STORY-2: Lock Status Indicator (5 pts)

**Sprint**: Week 3 | **Blocked**: BE-001.3

**User Story**:  
As a viewer, when resource locked, I want see who holds lock, so I know when I can edit.

**Tasks**:

- [ ] Lock status component HTML/CSS (1h)
- [ ] Handle `lock_acquired` event (1h)
- [ ] Handle `lock_denied` event (1h)
- [ ] Handle `lock_released` event (30min)
- [ ] Countdown timer for TTL (1.5h)
- [ ] Request Lock button UI (1h)

**DoD**: All lock events handled, UI updates in real-time

**Files**: `complete-reports-test.html`

---

### STORY-3: Heartbeat System (3 pts)

**Sprint**: Week 3 | **Blocked**: BE-001.3

**User Story**:  
As an editor, when I hold lock, I want auto-renewal, so I don't lose permission.

**Tasks**:

- [ ] 60s interval timer implementation (1h)
- [ ] Emit `heartbeat` WebSocket event (30min)
- [ ] TTL warning toast (<1 min remaining) (1h)
- [ ] Stop heartbeat on disconnect (30min)

**DoD**: Lock doesn't expire while actively editing

**Files**: `complete-reports-test.html` (WebSocketService)

---

### STORY-4: ResourceId Migration (5 pts)

**Sprint**: Week 4 | **Depends**: STORY-2, STORY-3

**User Story**:  
As a developer, when calling backend, I need explicit format `"doc:123:main"`, so tab locks work.

**Tasks**:

- [ ] Audit all resourceId usages in codebase (1h)
- [ ] Update join/lock calls to explicit format (2h)
- [ ] Test old format backward compat (Week 3-4) (1h)
- [ ] Monitor deprecation logs â†’ 0 warnings (1h)

**DoD**: Zero deprecation warnings by Nov 29

**Files**: All UI test files

---

### STORY-5: Toast Notifications (2 pts)

**Sprint**: Week 3 | **Blocked**: BE-001.3

**User Story**:  
As a user, when lock denied, I want notification, so I understand why.

**Tasks**:

- [ ] Toast component HTML/CSS (1h)
- [ ] Hook to lock events (30min)
- [ ] Auto-dismiss after 5s (30min)

**DoD**: Toast on lock denied/released/expired

**Files**: `complete-reports-test.html`

---

### STORY-6: Grace Period Reconnect (3 pts)

**Sprint**: Week 4 | **Blocked**: BE-001.3

**User Story**:  
As an editor, when WiFi drops, I want reconnect with lock, so I don't lose work.

**Tasks**:

- [ ] Reconnect overlay UI (1h)
- [ ] Handle disconnect event (1h)
- [ ] Handle reconnect within 30s (1h)

**DoD**: Reconnect < 30s â†’ Lock preserved

**Files**: `complete-reports-test.html` (WebSocketService)

---

## ðŸ“… Sprint Plan

**Week 3** (13 pts): STORY-1 (start now), STORY-2, STORY-3, STORY-5 (after BE Nov 25)  
**Week 4** (8 pts): STORY-4, STORY-6

---

## ðŸ§ª BDD Test Scenarios

### Scenario 1: Multi-Editor Warning

```gherkin
Feature: Multi-Editor Conflict Warning

Scenario: Warning when 2+ editors
  Given 2 editors in "document:123"
  When user list updates
  Then warning banner visible
  And conflict counter shows "2 editors"
  And editor cards have red badges
```

### Scenario 2: Lock Status Display

```gherkin
Feature: Lock Status Indicator

Scenario: Show who holds lock
  Given Dr. Smith holds lock on "document:123:main"
  When I join as viewer
  Then lock icon ðŸ”’ visible next to resource ID
  And "Locked by: Dr. Smith" displayed
  And countdown timer shows "4:30 remaining"
```

### Scenario 3: Lock Denial Toast

```gherkin
Feature: Lock Request Denial

Scenario: Toast on denied lock
  Given Dr. Smith holds lock
  When I click "Request Lock"
  Then backend emits lock_denied
  And toast shows "Document locked by Dr. Smith"
  And toast auto-dismisses after 5s
```

### Scenario 4: Heartbeat Renewal

```gherkin
Feature: Heartbeat Lock Renewal

Scenario: Lock renewed every 60s
  Given I hold lock on "document:123:main"
  When 60 seconds pass
  Then frontend emits heartbeat event
  And backend renews lock TTL to 300s
  And countdown timer resets to "5:00"
```

### Scenario 5: Lock Release Notification

```gherkin
Feature: Lock Release Event

Scenario: Notify when lock available
  Given Dr. Smith holds lock
  And I am viewer
  When Dr. Smith releases lock
  Then backend emits lock_released
  And toast shows "Document now available"
  And "Request Lock" button enabled
```

### Scenario 6: Grace Period Reconnect

```gherkin
Feature: Reconnect Within Grace Period

Scenario: WiFi drop preserves lock
  Given I hold lock on "document:123:main"
  When WiFi disconnects
  And I reconnect within 30s
  Then lock preserved
  And "Reconnected" toast shows
  And countdown continues from last value
```

---

## âœ… Pre-Deployment Checklist

### Functional

- [ ] Multi-editor warning shows for 2+ editors
- [ ] Lock status visible (icon, holder, countdown)
- [ ] Toast on lock denied/released/expired
- [ ] Heartbeat pings every 60s
- [ ] ResourceId format `"doc:123:main"` everywhere
- [ ] Grace period reconnect < 30s works

### Edge Cases

- [ ] Rapid reconnect doesn't break lock
- [ ] Clock skew doesn't show negative timer
- [ ] Single tab check prevents duplicate locks
- [ ] Tab close stops heartbeat immediately

### Performance

- [ ] Heartbeat overhead < 10KB/min
- [ ] Toast doesn't block UI
- [ ] Countdown updates smooth (no lag)

### UX

- [ ] Lock icon clear and visible
- [ ] Toast messages user-friendly
- [ ] Countdown timer readable
- [ ] Warning banner dismissible

### Migration

- [ ] Old format tested (Week 3-4)
- [ ] Deprecation logs monitored
- [ ] Zero warnings by Nov 29
- [ ] BE Week 5 kill tested

---

**Status**: Ready for Week 3 implementation  
**Next Review**: Monday, Nov 25, 2025
